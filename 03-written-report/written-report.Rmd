---
title: "Your project title"
author: "Last!: Parker Dingman, Ethan Donecoff, Karam Oubari, Pei Yi Zhuo"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r load-packages-data}
# load packages and data
library(tidyverse)
library(here)
life <- read_csv(here("data", "life_expectancy.csv"))
regions <- read_csv(here("data", "regions.csv"))
```

```{r add-region, include=FALSE}
regions <- regions %>%
  select(Country, Region) %>%
  mutate(Country = gsub("&", "and", Country))

initial_join <- life %>%
  left_join(regions, by = "Country") %>%
  select(Country, Region, Year:Schooling)

(na_countries <- initial_join %>%
  select(Country, Region) %>%
  distinct() %>%
  filter(is.na(Region)) %>%
  select(Country) %>%
  pull())

# Montenegro, Niue, and South Sudan do not appear in 'regions'
regions <- regions %>%
  mutate(
    Country = case_when(
      Country == "Bahamas, The" ~ "Bahamas",
      Country == "Bolivia" ~ "Bolivia (Plurinational State of)",
      Country == "Brunei" ~ "Brunei Darussalam",
      Country == "Cote d'Ivoire" ~ "CÃ´te d'Ivoire",
      Country == "Cape Verde" ~ "Cabo Verde",
      Country == "Central African Rep." ~ "Central African Republic",
      Country == "Congo, Repub. of the" ~ "Congo",
      Country == "Czech Republic" ~ "Czechia",
      Country == "Korea, North" ~ "Democratic People's Republic of Korea",
      Country == "Congo, Dem. Rep." ~ "Democratic Republic of the Congo",
      Country == "Gambia, The" ~ "Gambia",
      Country == "Iran" ~ "Iran (Islamic Republic of)",
      Country == "Laos" ~ "Lao People's Democratic Republic",
      Country == "Micronesia, Fed. St." ~ "Micronesia (Federated States of)",
      Country == "Burma" ~ "Myanmar",
      Country == "Korea, South" ~ "Republic of Korea",
      Country == "Moldova" ~ "Republic of Moldova",
      Country == "Russia" ~ "Russian Federation",
      Country == "Syria" ~ "Syrian Arab Republic",
      Country == "Macedonia" ~ "The former Yugoslav republic of Macedonia",
      Country == "East Timor" ~ "Timor-Leste",
      Country == "United Kingdom" ~ "United Kingdom of Great Britain and Northern Ireland",
      Country == "Tanzania" ~ "United Republic of Tanzania",
      Country == "United States" ~ "United States of America",
      Country == "Venezuela" ~ "Venezuela (Bolivarian Republic of)",
      Country == "Vietnam" ~ "Viet Nam",
      TRUE ~ Country
    )
  )

life <- life %>%
  left_join(regions, by = "Country") %>%
  select(Country, Region, Year:Schooling)

life$Region[life$Country == "Montenegro"] <- "EASTERN EUROPE"
life$Region[life$Country == "Niue"] <- "OCEANIA"
life$Region[life$Country == "South Sudan"] <- "SUB-SAHARAN AFRICA"

rm(initial_join)
rm(na_countries)
rm(regions)

# life dataset after joining and with data from all years
life_all <- life
```

```{r filter-year, include=FALSE}
na_prop <- function(x) {
  x %>%
    is.na() %>%
    sum() %>%
    prod(1 / n()) 
}

years <- rep(list(NA), 16)
for(year in 2000:2015) {
  temp <- life %>%
    filter(Year == year) %>%
    summarize(across(everything(), na_prop)) %>%
    pivot_longer(cols = everything(),
                 names_to = "variable",
                 values_to = "na_prop") %>%
    pull(na_prop)
  names(temp) <- names(life)
  years[[year - 1999]] <- temp
}
names(years) <- 2000:2015

# 2011 is the latest year where no variable 
# has a missing rate greater than 0.22.
map_dbl(years, ~ any(`>`(., 0.22)))

# All the years where no variable has a missing rate greater 
# than 0.22 has a 'population' missing rate of 0.2185792.
map(years, ~ .[`>`(., 0.20)])

life <- filter(life, Year == 2011)

# Remove unnecessary objects
rm(na_prop)
rm(years)
rm(year)
rm(temp)
```

Your written report goes here! Before you submit, make sure your code chunks are turned off with `echo = FALSE` and there are no warnings or messages with `warning = FALSE` and `message = FALSE` 

## Introduction and Data

By telling us the average age of death in a population, life expectancy is a key metric for understanding a country's health. According to Max Roser, Esteban Ortiz-Ospina and Hannah Ritchie from Our World in Data, "Broader than the narrow metric of the infant and child mortality, which focus solely at mortality at a young age, life expectancy captures the mortality along the entire life course."[1] Over the course of history, life expectancy has risen dramatically. It is estimated that in pre-modern times, life expectancy worldwide was only about 30 years. Since the Industrial Revolution in the 18th and 19th centuries, many countries had huge gains in this number. And since the beginning of the 20th century, global average life expectancy has risen to about 70 years. However, there remain huge inequalities in this number. Currently (as of 2019), the Central African Republic has the lowest life expectancy of 53 years while Japan has the highest with 83.

In addition to the more obvious health-related connections to life expectancy, numerous pieces of academic literature have delved into the non-medical factors behind life expectancy. A major example is a longitudinal study conducted by Charles Lin, Eugene Rogot, Norman Johnson, Paul Sorlie, and Elizabeth Arias, which examined life expectancy by socioeconomic factors.[2] Academic literature such as this provides us with motivations to examine this topic on an international level, looking at various health-related and non-health-related factors that connect to life expectancy.

In terms of initial hypotheses of model selection, we expect that the strongest predictors of life expectancy will be `Adult Mortality`, `infant deaths`, and `GDP`. We also predict that countries that have `status` equal to "Developed" will have higher life expectancy than those that have `status` equal to "Developing". We also predict that, on average, life expectancy will have increased internationally in the 15 years that are documented in the data set.

Our selected data set is comprised of information that others gleaned from the websites of the World Health Organization and the United Nations. Every entry describes the health, social, and economic conditions for one of 193 countries in a given year from 2000 to 2015. Additional information can be found on https://www.kaggle.com/kumarajarshi/life-expectancy-who.

We also combined this data set with another data set downloaded from https://www.kaggle.com/fernandol/countries-of-the-world. 

\newpage

## Exploratory Data Analysis

First, we will look at some summary statistics of our response variable, 'Life expectancy'.

```{r summary-stats1, warning = FALSE}
life_all %>%
  filter(!is.na(`Life expectancy`)) %>%
  summarize(min = min(`Life expectancy`), 
            max = max(`Life expectancy`),
            range = max - min,
            mean = mean(`Life expectancy`), 
            median = median(`Life expectancy`), 
            Q1 = quantile(`Life expectancy`, .25), 
            Q3 = quantile(`Life expectancy`, .75), 
            iqr = IQR(`Life expectancy`), 
            sd = sd(`Life expectancy`)) %>%
  kable(digits = 3, caption = "Summary Statistics of Response Variable, Life Expectancy")
```

These summary statistics give a rough idea of the distribution of the response variable.
The median life expectancy (~72 yrs) is almost 3 years larger than the mean (~69 yrs).
Additionally, the median is closer to the third quartile than the first quartile. 
This suggests that life expectancy may be left-skewed, which we will evaluate further 
with visualizations.

Because the dataset includes data collected each year for 15 years, we must consider
possible time-dependence of life expectancy. This is an important relationship that
will need to be addressed during model construction and statistical tests. For now,
we can generate summary statistics at the beginning (year 2000) and the end (year 2015)
to get a broad idea of how life expectancy varies over time. Naturally, we expect that
life expectancy increases over time as global health and development generally improve.

```{r summary-stats2, warning = FALSE}
life_all %>%
  filter(!is.na(`Life expectancy`)) %>%
  filter(Year == "2000") %>%
  summarise(world_avg_2000 = mean(`Life expectancy`)) %>%
  kable(digits = 3, caption = "2000 World Average Life Expectancy")

life_all %>%
  filter(!is.na(`Life expectancy`)) %>%
  filter(Year == "2000") %>%
  summarise(world_median_2000 = median(`Life expectancy`)) %>%
  kable(digits = 3, caption = "2000 World Median Life Expectancy")

life_all %>%
  filter(!is.na(`Life expectancy`)) %>%
  filter(Year == "2015") %>%
  summarise(world_avg_2015 = mean(`Life expectancy`)) %>%
  kable(digits = 3, caption = "2015 World Average Life Expectancy")

life_all %>%
  filter(!is.na(`Life expectancy`)) %>%
  filter(Year == "2015") %>%
  summarise(world_median_2015 = median(`Life expectancy`)) %>%
  kable(digits = 3, caption = "2015 World Median Life Expectancy")
```

We see that the mean life expectancy increased by more than 4 years between 2000 and 2015.
The median also increased by almost 3 years over the same time period. This confirms
the relationship we expected. Because life expectancy increases over time, we must be
careful when generating our models. Without a proper consideration of time, it may 
be a confounding variable between life expectancy and other predictors.

Now, we will look at some summary visualizations of life expectancy.

```{r summary-viz}
p1 <- ggplot(data = life_all, mapping = aes(x = `Life expectancy`)) + 
  geom_histogram() + 
  labs(title = "Distribution of Life Expectancy",
       subtitle = "2000-2015",
       x = "Life Expectancy (Years)",
       y = "Count")

p2 <- ggplot(data = life_all, mapping = aes(x = `Life expectancy`)) + 
  geom_density() + 
  labs(title = "Distribution of Life Expectancy",
       subtitle = "2000-2015",
       x = "Life Expectancy (Years)",
       y = "Proportion")

p3 <- ggplot(data = life_all, mapping = aes(x = `Life expectancy`, y = "")) + 
  geom_boxplot() + 
  labs(title = "Distribution of Life Expectancy",
       subtitle = "2000-2015",
       x = "Life Expectancy (Years)",
       y = "")

(p1 + p2) / p3
```

Here we see that life expectancy is left skewed with a center just over 70 years.
Life expectancy ranges from about 40 years to 90 years. 

## Methodology

In this project we plan on using various regression analysis methods including, but not limited to, multiple linear regression, statistical inference, analysis of variance, and model selection in an attempt to understand country and region-level life expectancy, as well as the health, social, and economic relationships behind this number. 

The response variable we will be using in this project is `Life expectancy`. This is a measure of the average age of death in a year for the given country during that year. In terms of regression model technique, we will be using multiple linear regression because our response variable is quantitative.


```{r model-selection}



```



## Results

## Sources

[1] https://ourworldindata.org/life-expectancy \newline
[2] https://europepmc.org/article/med/12785422/reload=0#impact
